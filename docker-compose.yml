version: '2'

services:
    proxy:
        expose:
            - "80"
        ports:
            - "80:80"
        build: proxy
        container_name: proxy
        volumes:
            - proxy:/etc/apache2/
        networks:
            - frontend
            - backend

    fhem:
        expose:
            - "7072"
            - "8083"
            - "8383"
            - "2121"
        ports:
            - "2121:2121"
        build: fhem
        container_name: fhem
        privileged: true
        devices:
          - "/dev/ttyUSB0:/dev/ttyUSB0"
          - "/dev/ttyACM0:/dev/ttyACM0"
        volumes:
            - fhem:/opt/fhem
        networks:
            - frontend
            - backend
            - database
        depends_on:
            - "mysql"
            - "proxy"

    homebridge:
        expose:
            - "51826"
            - "8282"
            - "5353"
        ports:
            - "51826:51826"
            - "8282:8282"
            - "5353:5353"
        build: homebridge
        container_name: homebridge
        volumes:
            - homebridge:/root
        network_mode: host
        depends_on:
            - "fhem"

    habridge:
        expose:
            - "8888"
        ports:
            - "8888:8888"
        build: habridge
        container_name: habridge
        volumes:
            - habridge:/config
        network_mode: host
        depends_on:
            - "fhem"

    smartvisu:
        expose:
            - "80"
        build: smartvisu
        container_name: smartvisu
        volumes:
            - smartvisu:/usr/share/nginx
        networks:
            - backend
        depends_on:
            - "fhem"

    mysql:
        expose:
            - "3306"
            - "33060"
        image: mysql/mysql-server:5.7
        container_name: mysql
        volumes:
            - ./mysql/init.sql:/docker-entrypoint-initdb.d/fhem-init.sql
            - mysql:/var/lib/mysql
        environment:
            - MYSQL_RANDOM_ROOT_PASSWORD=yes
        networks:
            - database

networks:
    frontend:
        driver: bridge
    backend:
        driver: bridge
    database:
        driver: bridge

volumes:
    fhem:
    mysql:
    homebridge:
    proxy:
    habridge:
    smartvisu:
